# LBPM 快速开始指南

## 🎯 三步完成编译

### 📍 当前位置

你现在在: `/home/serennan/work/LBPM/scripts/`

所有安装脚本都已准备好，只需按顺序执行即可。

---

## ⚡ 三条命令搞定一切

在终端中执行：

```bash
# 第 1 步: 安装 CUDA（15-20 分钟，需要 sudo）
bash scripts/install_cuda.sh

# 第 2 步: 安装 SILO（10-15 分钟，需要 sudo）
bash scripts/install_silo.sh

# 第 3 步: 编译 LBPM（20-30 分钟）
bash scripts/build_lbpm_full.sh
```

**总耗时**: 约 50 分钟

---

## 📝 详细说明

### 第 1 步: 安装 CUDA Toolkit

```bash
bash scripts/install_cuda.sh
```

**会做什么**:
- 下载 CUDA 12.6 安装包（~3 GB）
- 安装 CUDA 工具链
- 配置环境变量

**完成后**:
- 重新打开终端，或运行 `source ~/.bashrc`
- 验证: `nvcc --version` 应显示版本信息

---

### 第 2 步: 安装 SILO 库

```bash
bash scripts/install_silo.sh
```

**会做什么**:
- 下载 SILO 4.11 源码
- 编译并安装到 `/opt/silo`

**完成后**:
- 验证: `ls /opt/silo/lib` 应显示库文件

**跳过此步**:
- 如果不需要 SILO 可视化，可以跳过
- 编译脚本会自动检测并禁用 SILO

---

### 第 3 步: 编译 LBPM

```bash
bash scripts/build_lbpm_full.sh
```

**会做什么**:
1. ✅ 检查所有依赖（CUDA, MPI, HDF5, SILO）
2. ✅ 自动检测 GPU 架构（sm_86）
3. ✅ 配置 CMake
4. ✅ 编译（make -j4）
5. ✅ 安装到 `~/build/LBPM-full`
6. ✅ 运行快速测试

**完成后**:
- 构建目录: `~/build/LBPM-full`
- 可执行文件: `~/build/LBPM-full/tests/lbpm_*_simulator`

---

## ✅ 验证安装

### 检查编译结果

```bash
# 查看生成的模拟器
ls ~/build/LBPM-full/tests/lbpm_*_simulator

# 运行测试
cd ~/build/LBPM-full
ctest
```

### 测试 GPU 加速

```bash
# 终端 1: 运行程序
cd ~/build/LBPM-full/tests
./lbpm_color_simulator --help

# 终端 2: 监控 GPU（应该看到 GPU 使用率 > 0%）
watch -n1 nvidia-smi
```

---

## 🔧 可选：一键安装

如果你确定要一次性运行所有步骤（需要保持终端开启 50 分钟）：

```bash
bash scripts/install_cuda.sh && \
bash scripts/install_silo.sh && \
bash scripts/build_lbpm_full.sh
```

**提示**: 期间会要求输入 sudo 密码（CUDA 和 SILO 安装时）

---

## 📊 系统要求检查

在开始前，确认你的系统满足：

```bash
# 检查磁盘空间（需要至少 5 GB）
df -h ~

# 检查内存（需要至少 8 GB）
free -h

# 检查 GPU
nvidia-smi

# 检查已有依赖
mpicc --version    # MPI 编译器
h5dump --version   # HDF5 库
cmake --version    # CMake 3.9+
```

---

## ⚠️ 常见问题快速解决

### CUDA 安装后找不到 nvcc

```bash
# 重新加载环境变量
source ~/.bashrc

# 或者重新打开终端
```

### 编译时内存不足

脚本会自动降低并行度。如果还是失败：

```bash
cd ~/build/LBPM-full
make -j1  # 单线程编译
```

### GPU 不工作

```bash
# 检查 CUDA
nvcc --version

# 重新编译
rm -rf ~/build/LBPM-full
bash scripts/build_lbpm_full.sh
```

---

## 📚 更多文档

- **README**: `scripts/README.md` - 完整说明
- **安装指南**: `scripts/lbpm_install_guide.txt` - 详细步骤
- **依赖摘要**: `scripts/lbpm_dependencies_summary.txt` - 配置信息
- **编译指南**: `docs/编译指南.md` - 中文完整文档

---

## 🎉 完成后

编译成功后，你可以：

### 1. 设置环境（可选）

```bash
source ~/build/LBPM-full/setup_env.sh
```

### 2. 运行示例

```bash
cd ~/build/LBPM-full/tests
./lbpm_color_simulator --help
```

### 3. 开始开发

参考 `CLAUDE.md` 了解项目架构

---

**准备好了吗？从第一条命令开始吧！** 🚀

```bash
bash scripts/install_cuda.sh
```
